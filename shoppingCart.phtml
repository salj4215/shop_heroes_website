<link rel="stylesheet" type="text/css" href="styleOrder.css">
<!DOCTYPE html>
<head>
	<meta charset="UTF-8">
	<meta name="keywords" content="Shopping cart">
	<meta name="description" content="Shopping cart page">
	<link rel="stylesheet" type="text/css" href="ShoppingCart.css">
	<title>Shopping Cart page</title>
</head>
<body>
<?php       //test that user is logged in.
if((isset($_SESSION['activeUserID'])) && ($_SESSION['activeUserID'] != 0 ))
{
//////////////////////////////////////////////////////////////////////////////////////////////////////
if(( isset( $_POST['action'] )) && $_POST['action'] == 'cartQty' )
{
    $newQty = $_POST['quantity'];
    echo "<br> $newQty";
    echo "<br>" . var_export($newQty,true) . "<br>";
}


//////////////////////////////////////////////////////////////////////////////////////////////////////
    if(isset($_COOKIE['cart'])) {
        $cookieCart = $_COOKIE['cart'];
        $cookieCart = stripslashes($cookieCart);
        $cart = json_decode($cookieCart, true);
    }

$qry = 'Select * from `PRODUCTS` JOIN `STORES` ON PRODUCTS.StoreID = STORES.StoreID';
////call quuery
$stmt = $pdo -> query( $qry );
echo "<table class='products'>";
$numProductDisplayed = 0;
while($row = $stmt->fetch()) {   //if its in the cart
    foreach ($cart as $pid => $qty) {
        if ($row['ProductID'] == $pid) {
            //new table row per product
            //        var_dump($row['ProductID']);
            echo "<tr style='outline: thin solid'>";
            $productID = $row['ProductID'];
            //product pictures
            echo "<td><img src='images/products/128/_" . $row['ProductUPC'] . ".png' style='width:128px;height:128px;'></td>";
            //product informations
            echo "<td>ProductName: " . $row['ProductName'] .  "<br><br>ProductUPC: " . $row['ProductUPC'] . "</td>";
            echo "<td>UnitPrice: $" . $row['UnitPrice'] .  "<br><br>Store= ";
            if ($row['StoreID'] == 1) {
                echo "Kroger";
            };
            if ($row['StoreID'] == 2) {
                echo 'Meijer';
            };
            echo "</td>";
            ?>\
            echo "<form method='post' >";
            <td><input type="number" name="quantity" min="0" value="<?php echo $qty; ?>"></td>
            <?php
            //		echo "StoreID: " . $row['StoreID'] . "<br>";
            //		echo "ProductName: " . $row['ProductName'] . "<br>";
            //		echo "ProductUPC: " . $row['ProductUPC'] . "<br>";
            //		echo "UnitPrice: $" . $row['UnitPrice'] . "<br>";
            //		echo "ProductCategory: " . $row['ProductCategory'] . "<br>";
            //		echo "Description: " . $row['Description'] . "<br>";
            //		echo "Quantity: " . $row['Quantity'] . "<br>";
            //		echo "</div></br>";
            echo "<td>";
            echo"    <input type='hidden' name='action' value='cartQty' >";
            echo"    <button type='submit'>Update Quantity</button></td></form>";
            echo "<td>Total Price: </td><td>" . $UnitsPrice = ($qty * $row['UnitPrice']) . "</td>";
            echo "</form>";
        }
    }
}
echo "</table>";
?>

</body>
<?php }
else{
    array_push($_SESSION['messages'], "You must be logged-in to view 'ShoppingCart'");
    $_SESSION['announcements'] = -1;
    header('Location: index.php?page=login');
    echo "</body>";
}?>

